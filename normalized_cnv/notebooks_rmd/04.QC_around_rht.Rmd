---
output: 
    pdf_document

params: 
    set_title: "Analysis of CNV around RHT for QC"
    data_path: "~/Documents/WatSeq/Deletions/20200702/200bp/"
    gff_file: "~/Dropbox/JIC/WatSeq/Annotation/Triticum_aestivum.IWGSC.41.parts.tidy.gff3.gz"
title: "`r params$set_title`"
author: "Ricardo H. Ramirez-Gonzalez"
---
```{r, message=FALSE, echo=FALSE}
library(devtools)
library(knitr)
library(ggbio)
library(GenomicRanges)
library(GenomicFeatures)
library(rtracklayer)
library(dplyr)
library(RSQLite)
load_all("../bio.cnv/R", TRUE)
sd_path <- paste0(params$data_path, "libSD_short.csv")
libsd <- read.csv(sd_path)
noisy_lines <- libsd[libsd$SD > 0.45,]


gff<- import(params$gff_file)
covs_db = dbConnect(drv=RSQLite::SQLite(), dbname="~/Documents//WatSeq/Deletions/20200702/200bp/long_tables/covs_200bp.db")

```


This notebook is to look at some examples of lines where calling the CNV may be troublesome, based on the dispersion 

Out of  ``r nrow(libsd) `` lines, ``r nrow(noisy_lines)`` have an $\sigma > 0.45$.
We consider lines above the threshold as noisy. 


```{r,  message=FALSE, echo=FALSE}
plotHistogram(libsd, column = "SD",     binwidth=0.01, trim_range=F)

kable(noisy_lines)

```


```{r,  message=FALSE, echo=FALSE, fig.width=7, fig.height=9,  warning=FALSE}


gr4D <- GRanges("chr4D_part1", IRanges(18463838 - 1000000, 18472387 + 1000000))
lines2 <- c("WATDE0009", "WATDE0039", "WATDE0821", "WATDE0812", "WATDE0141", "WATDE0018", "B1190729.1")
lines <- c("WATDE0009", "WATDE0039", "WATDE0821", "WATDE0812")

plotRegionScatterLines(covs_db, gff, gr4D, lines=lines2)
```

